# Webhooks

## Sign up Webhook

You can register your webhook endpoint for receiving ConsCent user data by logging in to your ConsCent Client Dashboard and navigating to the [Webhook Page](https://client.conscent.in/dashboard/webhook). You will be able to enable/disable and edit your webhook url from this section. Once the webhook URL is registered and the webhook is in the enabled state - the endpoint will recieve user data anytime the user logins in for the first time on the client's website or application via ConsCent.

#### Security

You will either get the user's email or phoneNumber field and accordingly only one of hashedPhoneNumber or hashedEmail.
This hash is generated by using jwt.sign and passing the api secret as the secret. [Learn more about jwt here](https://jwt.io/). You can verify this by using jwt.verify for security purposes.

Alternately, you can check the authorization headers. Every request to the webhook uses Basic authorization with the api key as the username and the api secret as the password.

> The webhook returns a JSON in the request body - structured like this:

```json
{
  "userName": "9818329028",
  "userId": "7843y9xm44428xm24x2m0x2xm42",
  "freeTrial": true,
  "phoneNumber": "9818329028",
  "email": "test-email@webhook.com",
  "country": "IN",
  "hashedPhoneNumber": "7942mey829mxe1238z2ym9zy39my29zy2z9dy24793msy29z2z",
  "hashedEmail": "8392mx30mx2mu8034x02mx802ry2480nyd249yx420xfn20w4y04xm2024",
  "name": "Test Name",
  "city": "London",
  "location": {
    "latitude": 8359893,
    "longitude": 7438734,
    "postcode": 221993
  },
  "os": "Mac OS 10.16",
  "browser": "Chrome",
  "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36",
  "address": {
    "apartment": "7923492 Apartment1",
    "area": "Test Area",
    "pincode": "389023",
    "landmark": "test landmark",
    "city": "New York City",
    "state": "New York",
    "country": "US"
  },
  "clientTierId": "TestTierID1",
  "clientSpecificUserId": "11003289298"
}
```

Do note that you will receive either the phoneNumber or the email depending on what the user chooses to log in with.

## Login Webhook

You can register your webhook endpoint for receiving ConsCent user data by logging in to your ConsCent Client Dashboard and navigating to the [Webhook Page](https://client.conscent.in/dashboard/webhook). You will be able to enable/disable and edit your webhook url from this section. Once the webhook URL is registered and the webhook is in the enabled state - the endpoint will recieve user data (name, email, phone number, hashed email & phone number, city, location, address & country of the user) anytime the user logins in on the client's website or application via ConsCent.

#### Security

You will either get the user's email or phoneNumber field and accordingly only one of hashedPhoneNumber or hashedEmail.
This hash is generated by using jwt.sign and passing the api secret as the secret. [Learn more about jwt here](https://jwt.io/). You can verify this by using jwt.verify for security purposes.

Alternately, you can check the authorization headers. Every request to the webhook uses Basic authorization with the api key as the username and the api secret as the password.

**Your api key / api secret is visible in the SDK part of the Integration section of the client dashboard**

> The webhook returns a JSON in the request body - structured like this:

```json
{
  "userName": "9818329028",
  "phoneNumber": "9818329028",
  "email": "test-email@webhook.com",
  "userId": "7843y9xm44428xm24x2m0x2xm42",
  "freeTrial": true,
  "country": "IN",
  "hashedPhoneNumber": "7942mey829mxe1238z2ym9zy39my29zy2z9dy24793msy29z2z",
  "hashedEmail": "8392mx30mx2mu8034x02mx802ry2480nyd249yx420xfn20w4y04xm2024",
  "name": "Test Name",
  "city": "London",
  "location": {
    "latitude": 8359893,
    "longitude": 7438734,
    "postcode": 221993
  },
  "os": "Mac OS 10.16",
  "browser": "Chrome",
  "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36",
  "address": {
    "apartment": "7923492 Apartment1",
    "area": "Test Area",
    "pincode": "389023",
    "landmark": "test landmark",
    "city": "New York City",
    "state": "New York",
    "country": "US"
  },
  "clientTierId": "TestTierID1",
  "clientSpecificUserId": "11003289298"
}
```

## Subscription Payment Webhook

You can register your webhook endpoint for receiving ConsCent purchased subscription data by logging in to your ConsCent Client Dashboard and navigating to the [Webhook Page](https://client.conscent.in/dashboard/webhook). You will be able to enable/disable and edit your webhook url from this section. Once the webhook URL is registered and the webhook is in the enabled state - the endpoint will recieve user's purchased subscription data anytime the user purchases a subscription on the client's platform or application via ConsCent. Moreover, the webhook is secured by basic auth using the Clients API Key and API Secret provided by ConsCent on the SDK Integration section of the client dashboard - [ConsCent Client Integration](https://client.conscent.in/dashboard/integration). You can optionally choose to keep the endpoint as protected and authenticate using the provided credentials which are passed in the headers of the POST request to the configured webhook endpoint.

> The webhook returns a JSON in the request body - structured like this:

```json
{
  "_id": "61b9cf42f5d1f54797aaf14f",
  "userId": "7843y9xm44428xm24x2m0x2xm42",
  "purchaseId": "4932228982489248928208024",
  "manuallyRenewed": false,
  "renewSubscription": true,
  "renewalId": "61efb40a672c7f15840e803c",
  "renewalDetails": {
    "price": 300,
    "currency": "INR"
  },
  "availedOffers": [],
  "promotional": false,
  "tags": [],
  "bundle": false,
  "bundleContentIds": [],
  "paymentType": ["NETWORK"],
  "freeTrial": false,
  "migrated": false,
  "userAccount": "61b9cefbf5d1f54797aaf149",
  "clientId": "601a8ea4f2149f089782814f",
  "buyingPrice": 289.5,
  "price": 300,
  "country": "IN",
  "city": "bengaluru (nagashettyhalli)",
  "location": {
    "latitude": 13.0411,
    "longitude": 77.5702,
    "postcode": "560056"
  },
  "userCountry": "IN",
  "expiryDate": "2022-05-15T11:19:30.897Z",
  "priceDetails": {
    "price": 300,
    "currency": "INR"
  },
  "type": "SUBSCRIPTION",
  "subscriptionTitle": "Subscription 5",
  "device": "desktop",
  "subscriptionType": {
    "physical": false,
    "digital": true
  },
  "subscriptionId": "616ffd76621d69c5ee43c044",
  "tierId": "616ffd76621d69c5ee43c045",
  "createdAt": "2021-12-15T11:19:30.914Z",
  "updatedAt": "2021-12-15T11:19:30.914Z",
  "userEmail": "test@email.com",
  "userPhoneNumber": "9999999999",
  "userName": "john doe",
  "clientSpecificUserId": "11003289298",
  "chosenTier": {
    "clientTierId": "Test Tier ID",
    "_id": "616ffd76621d69c5ee437485",
    "price": 300,
    "duration": 5,
    "priceOverrides": {
      "country": []
    },
    "currency": "INR",
    "basePrice": 0,
    "offers": []
  },
  "gstComponents": {
    "physical": 0,
    "digital": 0
  },
  "inrGstComponents": {
    "physical": 0,
    "digital": 0
  },
  "userAddress": {
    "apartment": "17973 Octane Drive",
    "area": "Sun Valley",
    "pincode": "90210",
    "landmark": "",
    "city": "Los Angeles",
    "state": "California",
    "country": "US"
  },
  "renewedSubscriptionDetails": {
    "renewalCount": 1,
    "rzpSubscriptionId": "sub_Inua2HuuV2lxLG",
    "nextRenewalDate": "2022-06-25T08:38:18.369Z",
    "autoRenew": "ACTIVE",
    "price": 300,
    "currency": "INR"
  }
}
```

## Subscription Cancelled Webhook

You can register your webhook endpoint for receiving data whenever a user cancels their subscription via ConsCent - by logging in to your ConsCent Client Dashboard and navigating to the [Webhook Page](https://client.conscent.in/dashboard/webhook). You will be able to enable/disable and edit your webhook url from this section. Once the webhook URL is registered and the webhook is in the enabled state - the endpoint will recieve user's cancelled subscription data, along with the details of the subscription and the last purchase/renewal of the user for the particular subscription - anytime the user cancels a client's subscription via ConsCent. Moreover, the webhook is secured by basic auth using the Clients API Key and API Secret provided by ConsCent on the SDK Integration section of the client dashboard - [ConsCent Client Integration](https://client.conscent.in/dashboard/integration). You can optionally choose to keep the endpoint as protected and authenticate using the provided credentials which are passed in the headers of the POST request to the configured webhook endpoint.

> The webhook returns a JSON in the request body - structured like this:

```json
{
  "cancelledSubscriptionDetails": {
    "renewalCount": 0,
    "rzpSubscriptionId": "sub_InvqpVxG0vu7n8",
    "status": "CANCELLED",
    "price": 300,
    "currency": "INR"
  },
  "userEmail": "admin1@seed.com",
  "userPhoneNumber": "9869779647",
  "userId": "7843y9xm44428xm24x2m0x2xm42",
  "userName": "john doe",
  "userAddress": {
    "apartment": "",
    "area": "",
    "pincode": "",
    "landmark": "",
    "city": "",
    "state": "",
    "country": ""
  },
  "clientSpecificUserId": "11003289298",
  "subscriptionDetails": {
    "freeTrial": {
      "enabled": true,
      "duration": 14
    },
    "recommended": false,
    "benefits": "benefit ewiowe, benefit 2",
    "physical": false,
    "digital": true,
    "enabled": true,
    "migrated": false,
    "couponsEnabled": true,
    "adminCoupon": "",
    "usedCouponNumbers": [1],
    "_id": "616ffd76621d69c5ee43c044",
    "clientId": "601a8ea4f2149f089782814f",
    "title": "Subscription 5",
    "iconUrl": "https://conscent-subscriptions.s3.ap-south-1.amazonaws.com/local/Samakshs-MacBook-Pro-2.local/Screenshot%202021-07-22%20at%209.05.01%20PM.png",
    "tiers": [
      {
        "priceOverrides": {
          "country": []
        },
        "currency": "INR",
        "basePrice": 0,
        "offers": [],
        "_id": "616ffd76621d69c5ee43c045",
        "price": 300,
        "duration": 5
      }
    ],
    "couponCount": 5,
    "createdAt": "2021-10-20T11:28:54.143Z",
    "updatedAt": "2022-01-19T06:45:18.634Z",
    "__v": 5
  },
  "lastPurchaseDetails": {
    "location": {
      "latitude": 13.0411,
      "longitude": 77.5702,
      "postcode": "560056"
    },
    "gstComponents": {
      "physical": 0,
      "digital": 0
    },
    "inrGstComponents": {
      "physical": 0,
      "digital": 0
    },
    "manuallyRenewed": false,
    "renewSubscription": true,
    "availedOffers": [],
    "promotional": false,
    "tags": [],
    "bundle": false,
    "bundleContentIds": [],
    "paymentType": ["REPEAT", "NETWORK"],
    "freeTrial": false,
    "migrated": false,
    "clientId": "601a8ea4f2149f089782814f",
    "buyingPrice": 289.5,
    "price": 300,
    "country": "IN",
    "city": "bengaluru (nagashettyhalli)",
    "userCountry": "IN",
    "expiryDate": "2023-04-25T09:52:52.814Z",
    "priceDetails": {
      "price": 300,
      "currency": "INR"
    },
    "type": "SUBSCRIPTION",
    "subscriptionTitle": "Subscription 5",
    "operatingSystem": "Mac OS",
    "device": "desktop",
    "subscriptionType": {
      "physical": false,
      "digital": true
    },
    "subscriptionId": "616ffd76621d69c5ee43c044",
    "tierId": "616ffd76621d69c5ee43c045",
    "renewalId": "61efc865acb0d82962e2ad14",
    "renewalDetails": {
      "price": 300,
      "currency": "INR"
    }
  }
}
```

## Pass Payment Webhook

You can register your webhook endpoint for receiving data whenever a user pays for their pass via ConsCent - by logging in to your ConsCent Client Dashboard and navigating to the [Webhook Page](https://client.conscent.in/dashboard/webhook). You will be able to enable/disable and edit your webhook url from this section. Once the webhook URL is registered and the webhook is in the enabled state - the endpoint will recieve user's pass payment data, along with the details of the pass and the last purchase/renewal of the user for the particular pass - anytime the user purchases a client's pass via ConsCent. Moreover, the webhook is secured by basic auth using the Clients API Key and API Secret provided by ConsCent on the SDK Integration section of the client dashboard - [ConsCent Client Integration](https://client.conscent.in/dashboard/integration). You can optionally choose to keep the endpoint as protected and authenticate using the provided credentials which are passed in the headers of the POST request to the configured webhook endpoint.

> The webhook returns a JSON in the request body - structured like this:

```json
{
  "gstComponents": {
    "physical": 0,
    "digital": 0
  },
  "inrGstComponents": {
    "physical": 0,
    "digital": 0
  },
  "manuallyRenewed": false,
  "renewSubscription": false,
  "availedOffers": [],
  "promotional": false,
  "categories": [],
  "bundle": false,
  "bundleContentIds": [],
  "paymentType": [
    "NEW"
  ],
  "freeTrial": false,
  "migrated": false,
  "_id": "628b76941ed3d9c772be2626",
  "userAccount": "628b765e16d01ac4721e1676",
  "clientId": "5f92a62013332e0f667794dc",
  "clientContentId": "Client-Story-Id-1",
  "contentId": "628b6c2cbf5053737a28a63a",
  "buyingPrice": 80,
  "price": 100,
  "country": "IN",
  "city": "bengaluru (nagashettyhalli)",
  "location": {
    "latitude": 13.0411,
    "longitude": 77.5702,
    "postcode": "560056"
  },
  "userCountry": "IN",
  "expiryDate": "2022-05-23T18:57:07.989Z",
  "passTitle": "qwe",
  "priceDetails": {
    "price": 100,
    "currency": "INR"
  },
  "type": "PASS",
  "operatingSystem": "Mac OS",
  "device": "desktop",
  "createdAt": "2022-05-23T11:57:08.061Z",
  "updatedAt": "2022-05-23T11:57:08.061Z",
  "__v": 0,
  "userId": "628b765e16d01ac4721e1676",
  "userPhoneNumber": "9276278392",
  "userName": "",
  "userAddress": {
    "apartment": "",
    "area": "",
    "pincode": "",
    "landmark": "",
    "city": "",
    "state": "",
    "country": ""
  }
}
```
